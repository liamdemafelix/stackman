# Virtual Host Configuration for %domain%
# Generated by Stackman
#
# Do not delete the lines below.
# These lines are used to identify settings for a virtual host.
# 
# User: %user%
# Email: %email%
# Mode: %mode%
# Proxy: %proxy%
# PHP Version: %php%

<VirtualHost *:80>
    ServerName %domain%
    %server_alias_line%
    DocumentRoot %document_root%
    ErrorLog /home/%user%/logs/%domain%_error.log
    CustomLog /home/%user%/logs/%domain%_access.log combined

    Alias /.well-known/acme-challenge/ /home/%user%/acme-challenge/
    <Directory "/home/%user%/acme-challenge/">
        Options None
        AllowOverride None
        ForceType text/plain
        RedirectMatch 404 "^(?!/\.well-known/acme-challenge/[\w-]{43}$)"
    </Directory>

    <FilesMatch "\.php$">
        SetHandler  "proxy:unix:%fpm_socket%|fcgi://localhost/"
    </FilesMatch>
</VirtualHost>

<VirtualHost *:443>
    ServerName %domain%
    %server_alias_line%
    DocumentRoot %document_root%
    ErrorLog /home/%user%/logs/%domain%_error.log
    CustomLog /home/%user%/logs/%domain%_access.log combined

    SSLEngine On
    SSLCertificateFile "%ssl_cert%"
    SSLCertificateKeyFile "%ssl_key%"
    SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH
    SSLProtocol All -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLHonorCipherOrder On
    SSLCompression off

    Alias /.well-known/acme-challenge/ /home/%user%/acme-challenge/
    <Directory "/home/%user%/acme-challenge/">
        Options None
        AllowOverride None
        ForceType text/plain
        RedirectMatch 404 "^(?!/\.well-known/acme-challenge/[\w-]{43}$)"
    </Directory>

    <FilesMatch "\.php$">
        SetHandler  "proxy:unix:%fpm_socket%|fcgi://localhost/"
    </FilesMatch>
</VirtualHost>